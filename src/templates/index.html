<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Â§©Ê∞ó„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <link rel="stylesheet" href="styles/kindle.css">
    <meta http-equiv="refresh" content="1800">
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="„ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà">üåô</button>
    <div class="container">
        <main>
            <section class="weather-section">
                <div class="today-weather">
                    <h2 class="section-title">‰ªäÊó•„ÅÆÂ§©Ê∞ó</h2>
                    <div class="weather-main">
                        <div class="location">{{.Location}}</div>
                        <div class="weather-info">
                            <div class="weather-icon-large">{{.WeatherIcon}}</div>
                            <div class="temperature">{{.Temperature}}‚ÑÉ</div>
                            <div class="weather-details">
                                <div class="weather-desc">{{.Description}}</div>
                                <div class="temp-range">{{if gt .MinTemp 0}}ÊúÄ‰Ωé{{.MinTemp}}‚ÑÉ / {{end}}ÊúÄÈ´ò{{.MaxTemp}}‚ÑÉ</div>
                                <div class="feels-like">‰ΩìÊÑü{{.FeelsLike}}‚ÑÉ</div>
                            </div>
                        </div>
                    </div>

                    <div class="weather-extra">
                        {{if .Wind}}
                        <div class="weather-extra-item">
                            <span class="extra-label">È¢®:</span>
                            <span class="extra-value">{{.Wind}}</span>
                        </div>
                        {{end}}
                        {{if .ChanceOfRain}}
                        <div class="weather-extra-item">
                            <span class="extra-label">ÈôçÊ∞¥Á¢∫Áéá:</span>
                            <span class="extra-value">
                                {{range $index, $rain := .ChanceOfRain}}
                                    {{if $index}} / {{end}}
                                    {{if eq $index 0}}6-12ÊôÇ{{else if eq $index 1}}12-18ÊôÇ{{else}}18-24ÊôÇ{{end}}: {{$rain}}
                                {{end}}
                            </span>
                        </div>
                        {{end}}
                    </div>

                    <div class="temperature-chart">
                        <svg class="line-chart" viewBox="0 0 800 120" preserveAspectRatio="xMidYMid meet">
                            <!-- „Ç∞„É™„ÉÉ„ÉâÁ∑ö -->
                            <line x1="0" y1="95" x2="800" y2="95" stroke="#000" stroke-width="1"/>

                            <!-- Êäò„ÇåÁ∑ö„Ç∞„É©„Éï -->
                            <polyline
                                fill="none"
                                stroke="#000"
                                stroke-width="2"
                                points="{{range $index, $element := .HourlyForecast}}{{if $index}} {{end}}{{mul $index 50}},{{$element.ChartHeight}}{{end}}"
                            />

                            <!-- „Éá„Éº„Çø„Éù„Ç§„É≥„Éà -->
                            {{range $index, $element := .HourlyForecast}}
                            <circle cx="{{mul $index 50}}" cy="{{$element.ChartHeight}}" r="3" fill="#000"/>
                            <text x="{{mul $index 50}}" y="{{sub $element.ChartHeight 10}}" text-anchor="middle" font-size="10" fill="#000">{{$element.Temp}}‚ÑÉ</text>
                            <text x="{{mul $index 50}}" y="110" text-anchor="middle" font-size="9" fill="#000">{{$element.Time}}</text>
                            {{end}}
                        </svg>
                    </div>
                </div>

                <div class="forecast-weather">
                    <h2 class="section-title">‰ªäÂæå„ÅÆÂ§©Ê∞ó</h2>
                    <div class="hourly-forecast">
                        {{range $index, $element := .HourlyForecast}}
                        {{if lt $index 12}}
                        <div class="hourly-item">
                            <div class="hourly-time">{{$element.Time}}</div>
                            <div class="hourly-icon">{{$element.WeatherIcon}}</div>
                            <div class="hourly-temp">{{$element.Temp}}‚ÑÉ</div>
                            {{if $element.RainChance}}
                            <div class="hourly-rain">{{$element.RainChance}}</div>
                            {{end}}
                        </div>
                        {{end}}
                        {{end}}
                    </div>
                </div>
            </section>

            <section class="news">
                <div class="news-container">
                    <div class="news-column">
                        <h3 class="news-column-title">‰∏ªË¶Å„Éã„É•„Éº„Çπ</h3>
                        <div class="news-list">
                            {{range .News}}
                            <article class="news-item">
                                <div class="news-header">
                                    <div class="news-title"><a href="{{.Link}}">{{.Title}}</a></div>
                                    <span class="news-date">{{.PubDate}}</span>
                                </div>
                                <p class="news-description">{{.Description}}</p>
                            </article>
                            {{end}}
                        </div>
                    </div>
                    <div class="news-column">
                        <h3 class="news-column-title">ÁµåÊ∏à„Éã„É•„Éº„Çπ</h3>
                        <div class="news-list">
                            {{range .EconomyNews}}
                            <article class="news-item">
                                <div class="news-header">
                                    <div class="news-title"><a href="{{.Link}}">{{.Title}}</a></div>
                                    <span class="news-date">{{.PubDate}}</span>
                                </div>
                                <p class="news-description">{{.Description}}</p>
                            </article>
                            {{end}}
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p class="update-time">ÊúÄÁµÇÊõ¥Êñ∞: {{.UpdateTime}}</p>
            <p class="footer-credit">Powered by Â§©Ê∞ó‰∫àÂ†± API (weather.tsukumijima.net) / NHK „Éã„É•„Éº„Çπ RSS</p>
        </footer>
    </div>

    <script>
        // „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„ÉÜ„Éº„Éû„ÇíÂèñÂæó
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        }

        // „Ç∑„Çπ„ÉÜ„É†„ÅÆË®≠ÂÆö„Åß„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„ÅåÊúâÂäπ„Å™Â†¥Âêà
        if (!savedTheme && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            body.classList.add('dark-mode');
            themeToggle.textContent = '‚òÄÔ∏è';
        }

        // „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß„ÉÜ„Éº„Éû„ÇíÂàá„ÇäÊõø„Åà
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');

            if (body.classList.contains('dark-mode')) {
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            }
        });

        // SVG„ÅÆËâ≤„Çí„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„Å´ÂØæÂøú„Åï„Åõ„Çã
        function updateSVGColors() {
            const isDarkMode = body.classList.contains('dark-mode');
            const svgElements = document.querySelectorAll('.line-chart line, .line-chart polyline, .line-chart circle, .line-chart text');

            svgElements.forEach(el => {
                if (el.tagName.toLowerCase() === 'line' || el.tagName.toLowerCase() === 'polyline') {
                    el.setAttribute('stroke', isDarkMode ? '#e0e0e0' : '#000');
                } else if (el.tagName.toLowerCase() === 'circle') {
                    el.setAttribute('fill', isDarkMode ? '#e0e0e0' : '#000');
                } else if (el.tagName.toLowerCase() === 'text') {
                    el.setAttribute('fill', isDarkMode ? '#e0e0e0' : '#000');
                }
            });
        }

        // ÂàùÊúüË°®Á§∫ÊôÇ„Å´SVG„ÅÆËâ≤„ÇíÊõ¥Êñ∞
        updateSVGColors();

        // „ÉÜ„Éº„ÉûÂàá„ÇäÊõø„ÅàÊôÇ„Å´SVG„ÅÆËâ≤„ÇÇÊõ¥Êñ∞
        themeToggle.addEventListener('click', () => {
            setTimeout(updateSVGColors, 50);
        });
    </script>
</body>
</html>